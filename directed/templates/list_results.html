<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.1.1/chroma.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".att").each(function() {
                var val = parseFloat($(this).text());
                var scale = chroma.scale(['white', 'red']);
                var color = scale(val).hex();
                $(this).attr("bgcolor", color);
            });
        })
    </script>
</head>
<style>
    table, th, td {border: 1px solid black}
</style>
<body>
    <h2>{{ title }}</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Question</th>
            <th>Task</th>
            <th>Facts</th>
            <th>Attention</th>
            <th>Answer</th>
        </tr>
        {% for row in rows %}
            <tr>
                <td>{{ row.id }}</td>
                <td>{{ row.question }}</td>
                <td>{{ row.task }}</td>
                <td><ol>
                    {% for fact in row.facts %}
                    <li>{{ fact }}</li>
                    {% endfor %}
                </ol></td>
                <td>
                    <table>
                        <tr>
                            <th>facts</th>
                            {% for layer_idx in range(row.num_layers) %}
                            <th colspan="2">{{ layer_idx + 1 }}</th>
                            {% endfor %}
                        </tr>
                        <tr>
                            <td></td>
                            {% for layer_idx in range(row.num_layers) %}
                            <td>a</td><td>o</td>
                            {% endfor %}
                        </tr>
                        {% for fact, attention, output_gate in zip(row.facts, row.attentions, row.output_gates) %}
                        <tr>
                            <td>{{ fact }}</td>
                            {% for a, o in zip(attention, output_gate) %}
                            <td class="att">{{ a }}</td>
                            <td class="att">{{ o }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </table>
                </td>
                {% if row.correct %}
                <td bgcolor="#7fff00">yp = {{ row.yp }}<br>y = {{ row.y }}
                </td>
                {% else %}
                <td bgcolor="#8b0000">yp = {{ row.yp }}<br>y = {{ row.y }}
                </td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
</body>
</html>